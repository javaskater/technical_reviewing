# form

* when no action attribute is specified we use the same path and controller
  * than the GET route
* the first parameter to the POST method s the Taco Object
  * the same than in the html - form

```html
<form method="POST" th:object="${taco}">
```

* the second parameter _The @ModelAttribute applied to the Taco- Order parameter indicates that it should use the TacoOrder object that was placed into the model_
  * I don't understand this
  * it is the model attribute named *tacoOrder*
    * can we refind it after the redirection ?
## the checkbox:

```html
<input th:field="*{ingredients}" type="checkbox"
               th:value="${ingredient.id}"/>
```

* creates under Web Tools of Firefox:

```html
<input type="checkbox" value="CARN" id="ingredients4" name="ingredients">
```

* we have to translate the String *CARN* to the correspondent *Ingredient* object
  * because **{ingredients}* represents _private List<Ingredient> ingredients;_ of the Taco object passed on the form tag!
* p 70/520 *That’s where a converter comes in handy*

### the converter

* For the converter I create the same list of _Ingredient_ than found at _taco-cloud/src/main/java/tacos/web/DesignTacoController.java_
* nothing else to do than creating the class because
  * _will discover this, and any other Converter beans_
  * _will automatically regis-ter them with Spring MVC to be used when the conversion of request parameters to bound properties is needed_
  * here th Post request values are String, and the form bounded object expects a list of Ingredients

## The converter
* I forgot to declare __@Component__ for the converter. So it is never called
## back to the form
* the _@modelAttribute_ in a POST Method [Baeldung](https://www.baeldung.com/spring-mvc-and-the-modelattribute-annotation#2-as-a-method-argument)
  * here we get the TacOrder as it has been filled in the /design view

# in the designcontroller
* we pass a tacoOrder attribute with no name in the _processTaco_ method
* so the name tacoOrder is expected
  * and is to be found as ModelAttribute in the ControllerCode
* We pass this tacoOrder to the OrderController

# in the orderController
* we put the tacoOrder attribute into Session
  * it cannot have another name than what is passed from the _processTaco_ method in the designController

# 76/520
* We well see the TacoOrder in the Log with all of its tacos and the ingredients of each Taco
  * the __setComplete()__ of the _sessionStatus_ object : the tacoOrder object is cleaned up from the user's Session!
* Four steps to apply the validation:
1. Spring validation startr to the pom
2. Declare through annotations the validation rules on the clss to be validated
3. Specify that validation should be performed in the controller methods that require validation: specifically,
    1. the DesignTacoController’s processTaco() method (trough the @validate annotation to the corresponding paramter)
    2. and the OrderController ’s processOrder() method (trough the @validate annotation to the corresponding paramter).
4. In the view show validation errors
# 77 adding the validation starter
* right click on the _pom.xml_
* select _Spring / Add Starters_
* open the _I/O_ tab
  * select _validation_
* The following entry has been added to the __pom.xml__
```xml
<dependency>
	<groupId>org.springframework.boot</groupId>
	<artifactId>spring-boot-starter-validation</artifactId>
</dependency>
```
* STS rebuild the workspace
  * spring-boot-starter-validation-3.1.5.jar ha been added to  the STS's Maven dependenties....
* and also in my local filesystem:
  * with the sources jar (practical for debugging)
```bash
 jpmena@jpmena-ThinkCentre-M710t:~$ ll .m2/repository/org/springframework/boot/spring-boot-starter-validation/3.1.5/
total 48
drwxrwxr-x  2 jpmena jpmena 4096 nov.  28 14:22 ./
drwxrwxr-x 10 jpmena jpmena 4096 nov.  28 14:22 ../
-rw-rw-r--  1 jpmena jpmena  111 nov.  28 14:22 m2e-lastUpdated.properties
-rw-rw-r--  1 jpmena jpmena  292 nov.  28 14:22 _remote.repositories
-rw-rw-r--  1 jpmena jpmena 4768 nov.  28 14:22 spring-boot-starter-validation-3.1.5.jar
-rw-rw-r--  1 jpmena jpmena   40 nov.  28 14:22 spring-boot-starter-validation-3.1.5.jar.sha1
-rw-rw-r--  1 jpmena jpmena 2510 nov.  28 14:22 spring-boot-starter-validation-3.1.5.pom
-rw-rw-r--  1 jpmena jpmena   40 nov.  28 14:22 spring-boot-starter-validation-3.1.5.pom.sha1
-rw-rw-r--  1 jpmena jpmena 4744 nov.  28 14:22 spring-boot-starter-validation-3.1.5-sources.jar
-rw-rw-r--  1 jpmena jpmena   40 nov.  28 14:22 spring-boot-starter-validation-3.1.5-sources.jar.sha1
```

# 77/520
* processTaco in the DesinController takes a Taco as the first parameter
* processOrder in the OrderController takes a TacoOrder as the first parameter
* The 2 Beans need Valisation's annotations
* Remember: the _@Data_ annotation comes from Lombok ad is meant to create at the comile time:
  * a constructor with all the attributes
  * a getter and a setter for each attribute
* There is an error with the Validation annotations
  * since 3.1.0 they are provided by _jakarta_ and not by _javax_
  * the small remark under the [answer 0 of that post StackOverflow](https://stackoverflow.com/questions/76427644/spring-boot-javax-validation-annotations-are-not-working)
    * (_if you're on spring-boot 3.1.0 then these annotations are provided through jakarta._)
* the hibernate validator has been downloaded at the the same time (2.22 pm that 28th of november)
  * thant the spring-boot-starter-validation
```bash
jpmena@jpmena-ThinkCentre-M710t:~$ ll .m2/repository/org/hibernate/validator/hibernate-validator/8.0.1.Final/
total 2272
drwxrwxr-x 2 jpmena jpmena    4096 nov.  28 14:22 ./
drwxrwxr-x 7 jpmena jpmena    4096 nov.  28 14:22 ../
-rw-rw-r-- 1 jpmena jpmena 1327426 nov.  28 14:22 hibernate-validator-8.0.1.Final.jar
-rw-rw-r-- 1 jpmena jpmena      40 nov.  28 14:22 hibernate-validator-8.0.1.Final.jar.sha1
-rw-rw-r-- 1 jpmena jpmena   14531 nov.  28 14:22 hibernate-validator-8.0.1.Final.pom
-rw-rw-r-- 1 jpmena jpmena      40 nov.  28 14:22 hibernate-validator-8.0.1.Final.pom.sha1
-rw-rw-r-- 1 jpmena jpmena  948543 nov.  28 14:22 hibernate-validator-8.0.1.Final-sources.jar
-rw-rw-r-- 1 jpmena jpmena      40 nov.  28 14:22 hibernate-validator-8.0.1.Final-sources.jar.sha1
-rw-rw-r-- 1 jpmena jpmena     111 nov.  28 14:22 m2e-lastUpdated.properties
-rw-rw-r-- 1 jpmena jpmena     277 nov.  28 14:22 _remote.repositories
```
* in Python the regexp  for the expiration date gives
```python
>>> import re
>>> a = re.search("^(0[1-9]|1[0-2])([\/])([2-9][0-9])$", "05/25")
>>> a
<_sre.SRE_Match object; span=(0, 5), match='05/25'>
>>> a.group(0)
'05/25'
>>> a.group(1)
'05'
>>> a.group(2)
'/'
>>> a.group(3)
'25'
```
# 80/520 When to perform validation ?
* at form binding
  * that means in the POST annotated methods of our controllers
* _you need to add the JavaBean Validation API’s @Valid annotation to the Bean argument of the process mathod associated with the POST annotation_
* you also add a errors object

# 81/520
* _The th:errors attribute references the ccNumber field_ (of the tacoOrder object in the <form tag)
  * The tacoOrder Object has fields with validation's annotations
* in the design.html
  * all the checkbox have the same name *ingredients*
  * the input field has the name *name*
* so the function *${#fields.hasErrors('name')}* or *${#fields.hasErrors('ingredients')}*
* *th:errors="*{ingredients}"* takes the error's message field of the ingredients  attibute of the taco object !!!!
# 83/520
* [default Methods in interfaces](https://www.baeldung.com/java-static-default-methods) come from Java8
  * __WebMvcConfigurer__ is an interface with default methods
* How t replace the _HomController_ that we placed by mistake with the Beand objects
* _ViewControllerRegistry_ manipulates _ViewControllerRegistration_ objects
  * here we create a _ViewControllerRegistration_ for the / path and the _home_ wew name.
* the [@Configuration annotation](https://docs.spring.io/spring-framework/reference/core/beans/java/basic-concepts.html) is meant to declare Beans
  * Here a controller for the / path and home view
